<script>
    //Funciones del programa
    function actualizarDatos() {
        acciones += 1
        contadorIteraciones++
        numeroAnimales += aleatorio1y10()
        numeroAnimales -= aleatorio1y5()
    }
    //Comprueba que el usuario no supero el DINEROMAXIMO del programa
    function comprobacionDinero(dineroComprobar) {
        let mensajeGanarDinero = ("Has ganado " + dineroComprobar + "G")
        if (dinero + dineroComprobar > DINEROMAXIMO) {
            mostrarAlert(MENSAJEDINERO)
        } else {
            dinero += dineroComprobar
            mostrarAlert(mensajeGanarDinero)
        }
    }
    //Muestra un alert
    function mostrarAlert(mensaje) {
        let mensajeMostrar = alert(mensaje)
        return mensajeMostrar
    }
    //Devuelve numero aleatorio entre 1 y 10
    function aleatorio1y10() {
        return Number(Math.floor(Math.random() * 10) + 1)
    }
    //Devuelve numero aleatorio entre 1 y 5
    function aleatorio1y5() {
        return Number(Math.floor(Math.random() * 5) + 1)
    }
    //Funcionamiento seg√∫n el alimento elegido
    function Darcomida(opcionComida) {
        if (opcionComida == COMIDAFORRAJE) { //Opci√≥n Fruta
            //Comprueba comida disponible
            if (textoAlimento.length >= 1) {
                textoAlimento.pop()
                actualizarDatos()
                mostrarAlert(MENSAJEFORRAJE)
            } else {
                mostrarAlert(MENSAJENOHAYCOMIDA)
            }
        } else if (opcionComida == COMIDAFRUTA) {//Opci√≥n Fruta
            //Comprueba que haya comida disponible y que no haya enfermado
            if (textoAlimento.length >= 1 && estadoEnfermo == false) {
                textoAlimento.pop()
                actualizarDatos()
                //Comprueba que no supere el limite de "felicidad"
                if (textoFelicidad.length < MAXIMOFELICIDAD) {
                    textoFelicidad.push("‚ù§Ô∏è")
                }
                mostrarAlert(MENSAJEFRUTA)

                //Si no hay comida, manda alert
            } else {
                mostrarAlert("No tienes comida disponible o los animales enfermos no pueden comer frutaüçé")
            }
        }
    }

    //---------------------------MAIN-------------------------------------
    //Declarar los principales estados de los animales
    let numeroAnimales = 10
    const FELICIDADANIMAL = 4
    const ALIMENTOANIMAL = 4
    const ESTABLOANIMAL = 5
    let opcion
    let acciones = 0
    let dinero = 1500

    //Variables para la salud de los animales y nombre del "establo"
    let estadoEnfermo = false
    let estadoAnimal = "üòä"
    //Variable, para saber que alimento va a dar
    let darAlimento

    //Convertir Felicidad a emoji
    let textoFelicidad = []
    for (let i = 0; i < FELICIDADANIMAL; i++) {
        textoFelicidad.push("‚ù§Ô∏è")
    }
    //Convertir alimento a emoji
    let textoAlimento = []
    for (let i = 0; i < ALIMENTOANIMAL; i++) {
        textoAlimento.push("üåæ")
    }
    //Convertir establo a emoji
    let textoEstablo = []
    for (let i = 0; i < ESTABLOANIMAL; i++) {
        textoEstablo.push("üí©")
    }

    //Variables/constantes para "Mercado"
    let contadorIteraciones = 0
    const PRODUCTOSNOMBRES = [
        "Bebedero de Aguaüö∞",
        "Refugio para animalesüõñ",
        "Juguetes para animalesüß∏",
        "Malla de SombraüèñÔ∏è",
        "Sistema de Riegoüíß",
        "Herramientas de Limpiezaüßπ",
        "Luz Solar Artificialüí°",
        "Cercado Mejoradoüîê",
        "Medicina"
    ]
    const PRODUCTOSPRECIOS = [200, 500, 150, 300, 400, 100, 350, 600, 50]
    let productosNombreActual = []
    let productoPrecioActual = []
    let productosComprados = []
    let productosSeleccionados = 0
    //Bool que para el bucle de Mercado
    let compraValida = false
    //Comprueba si el producto se ha comprado antes
    let articuloComprado = false
    let articuloCurar = false
    //Usuario introduce que quiere comprar
    let usuarioCompra

    //Constantes del programa
    const ESTABLONOMBRE = prompt("Dime que nombre quieres para tu establo")
    const MAXIMOFELICIDAD = 4
    const MAXIMOALIMENTO = 4
    const MAXIMOESTABLO = 6
    const ESTABLOLIMPIO = 0
    const MAXIMOPRODUCTOS = 4
    const PRODUCTOSTOTALES = PRODUCTOSNOMBRES.length
    const MINIMOANIMALES = 0
    const MAXIMOANIMALES = 99
    const ENFERMO = 4
    const PRODUCTOSTIENDA = 4
    const CAMBIOTIENDA = 6
    const REINICIOITERACIONES = 3
    const COSTECOMIDA = 100
    const ENTORNOSUCIO = 3
    const ALIMENTARANIMALES = 1
    const JUGARANIMALES = 2
    const LIMPIARESTABLO = 3
    const COMPRARCOMIDA = 4
    const CURARANIMALES = 5
    const INFORMACION = 6
    const MERCADO = 7
    const PRODUCTO1 = 1
    const PRODUCTO2 = 2
    const PRODUCTO3 = 3
    const PRODUCTO4 = 4
    const SALIRMERCADO = 5
    const COMIDAFORRAJE = 1
    const COMIDAFRUTA = 2
    const DINEROMAXIMO = 9999
    const DINEROMINIMO = 0

    //Constantes para mensajes
    const MENSAJENOHAYCOMIDA = ("No tienes comida disponibleüåæüåæ")
    const MENSAJEANIMALESENFERMOS = ("Tus animales han enfermado ü§í")
    const MENSAJEFORRAJE = ("Le has dado de comer Forraje üåæ")
    const MENSAJEFRUTA = ("Le has dado de comer Fruta üçé")
    const MENSAJEJUGARANIMALES = ("Hemos jugado con los animalesüêÑ")
    const MENSAJEESTABLOLIMPIADO = ("Establo limpiadoüßπüí©")
    const MENSAJEESTABLOESTABALIMPIO = ("üßπTienes el establo limpio, no hace falta limpiarüßπ")
    const MENSAJECOMIDAREPUESTA = ("Comida repuestaüåæüçé, te ha costado " + COSTECOMIDA + "G")
    const MENSAJECOMIDALLENA = ("üåæNo puedes comprar m√°s comida, estas llenoüåæ")
    const MENSAJENODINERO = ("No tienes suficiente dineroüí≤")
    const MENSAJEANIMALESSALUDABLES = ("Tus animales ya estaban saludables, no necesitan curaci√≥n üòäüòä")
    const MENSAJEINFORMACION = ("Nombre del Establo: " + ESTABLONOMBRE + "\nN√∫mero de animales: " + numeroAnimales)
    const MENSAJEPRODUCTOESTABACOMPRADO = ("Ya lo has comprado anteriormente")
    const MENSAJEITERACIONES = ("Se suma (+üí©) y se resta (-‚ù§Ô∏è) x cada 3 Acciones")
    const MENSAJETIENDA = ("Cambiando la tienda...")
    const MENSAJEDINERO = ("Vas a superar el maximo de dinero, no recibes dinero")
    const MENSAJEFINAL = ("El juego ha terminado")
    const MENSAJEANIMALESCURADOS = ("Tus animales ya est√°n curados ü©πü©π")
    const MENSAJENECESITASLIMPIAR = ("Necesitas tener el establo limpio para poder curarlosüßπüßπ")
    const MENSAJEERROR = ("Opci√≥n no v√°lida, introduce un n√∫mero entre 1 y 5")
    const MENSAJEENTORNOSUCIO = ("üí©No puedes alimentar a los animales, el entorno est√° demasiado sucioüí©")

    //Bucle principal: Se detiene cuando los animales son 0 y superior de 99
    while (numeroAnimales > MINIMOANIMALES && numeroAnimales < MAXIMOANIMALES) {
        //Check para que cambien los objetos cada 5 veces y al inicio del programa
        if (contadorIteraciones % CAMBIOTIENDA === 0 || productosNombreActual.length === 0) {
            productosNombreActual = []
            productoPrecioActual = []
            productosSeleccionados = 0

            //Bucle para seleccionar 4 productos aleatorios
            while (productosSeleccionados < PRODUCTOSTIENDA) {
                contadorIteraciones = 0
                let indiceRandom = Math.floor(Math.random() * PRODUCTOSTOTALES)
                let productoActual = PRODUCTOSNOMBRES[indiceRandom]
                let precioActual = PRODUCTOSPRECIOS[indiceRandom]
                let productoComprado = false
                let productoseleccionado = false
                //Comprobaci√≥n para saber si el producto ha sido comprado
                for (let i = 0; i < productosComprados.length; i++) {
                    if (productosComprados[i] === productoActual) {
                        productoComprado = true
                    }
                }
                //Comprobaci√≥n para saber si el producto se repite
                for (let x = 0; x < productosNombreActual.length; x++) {
                    if (productosNombreActual[x] === productoActual) {
                        productoseleccionado = true
                    }
                }
                //Si el producto no se ha comprado ni se ha repetido, lo pushearemos en los productos actuales
                if (!productoComprado && !productoseleccionado) {
                    productosNombreActual.push(productoActual)
                    productoPrecioActual.push(precioActual)
                    productosSeleccionados++
                }
            }
            if (contadorIteraciones == 0) {
                contadorIteraciones = 1
            }
            //Condicional para evitar que se actualice el mercado otra vez si no se suman iteraciones
            mostrarAlert(MENSAJETIENDA)
        }

        //Comprobaci√≥n para salud de los animales
        if (textoEstablo.length >= ENFERMO) {
            estadoEnfermo = true
            estadoAnimal = "ü§í"
            mostrarAlert(MENSAJEANIMALESENFERMOS)
        }
        //Mensaje Principal del Programa
        let mensajePrincipal = ("Felicidad: " + textoFelicidad.join(" ") + "\nAlimentos Disponibles: " + textoAlimento.join(" ") + "\nEstablo: " + textoEstablo.join(" ")
            + "\nEstado de Salud: " + estadoAnimal + "\nN¬∫ Animales: " + numeroAnimales + "\nDinero: " + dinero + "G" + "\nInventario: " + productosComprados.join(" "))
        //Menu de Opciones
        let mostrarOpciones = ("\nElige una acci√≥n: " + "\n1. ü•ï ALIMENTAR A LOS ANIMALES ü•ï " + "\n2. üêëJUGAR CON LOS ANIMALES üêë "
            + "\n3. üí©LIMPIAR EL ESTABLO üí© " + "\n4. üõí COMPRAR COMIDA üõí " + "\n5. ü©∫CURAR ANIMALES ü©∫ " + "\n6. ‚ÑπÔ∏èCONSULTAR INFORMACION ‚ÑπÔ∏è " + "\n7. üööMERCADOüöö")

        //Muestra la pantalla inicial
        mostrarAlert(mensajePrincipal)

        opcion = prompt(mensajePrincipal + mostrarOpciones)

        //Opci√≥n "Alimentar animales"
        if (opcion == ALIMENTARANIMALES) {
            //Comprobaci√≥n del "establo"
            if (textoEstablo.length <= ENTORNOSUCIO) {
                Darcomida(darAlimento = Number(prompt("Dime que opcion de alimento quieres dar: " + "\n" + COMIDAFORRAJE + ". " + "Dar Forraje üåæ " + "\n" + COMIDAFRUTA + ". " + "Dar Fruta üçé")))
                //alert, por si hay demasiado extiercol, caso "alimentar"
            } else {
                mostrarAlert(MENSAJEENTORNOSUCIO)
            }
        } //Opci√≥n "Jugar con los animales"
        else if (opcion == JUGARANIMALES) {
            //Comprobaci√≥n del "establo"
            if (textoEstablo.length <= ENTORNOSUCIO && estadoEnfermo == false) {
                //Comprueba que haya comida disponible
                if (textoAlimento.length >= 1) {
                    textoAlimento.pop()
                    actualizarDatos()
                    //N¬∫ random entre 100 y 200 para sumarselo a nuestro dinero
                    let dineroSumar = Math.floor(Math.random() * 101) + 100
                    comprobacionDinero(dineroSumar)

                    //Comprueba que no supere el limite de "felicidad"
                    if (textoFelicidad.length < MAXIMOFELICIDAD) {
                        textoFelicidad.push('‚ù§Ô∏è')
                        textoFelicidad.join()
                    }
                    mostrarAlert(MENSAJEJUGARANIMALES)
                    //Si no hay comida, manda alert
                } else {
                    mostrarAlert(MENSAJENOHAYCOMIDA)
                }
                //alert, por si hay demasiado extiercol, opci√≥n "jugar"
            } else {
                mostrarAlert("No puedes jugar con los animales, ya que el ambiente es inadecuado o est√°n enfermosüí©ü§í")
            }
        } //Opci√≥n "Limpiar establo"
        else if (opcion == LIMPIARESTABLO) {
            //Comprueba que haya extiercol para quitarlo o no
            if (textoEstablo.length > 0) {
                while (textoEstablo.length > 0) {
                    textoEstablo.pop()
                }
                mostrarAlert(MENSAJEESTABLOLIMPIADO)
                actualizarDatos()
            } else {//No hay extiercol
                mostrarAlert(MENSAJEESTABLOESTABALIMPIO)
            }
        } //Opci√≥n "Comprar comida"
        else if (opcion == COMPRARCOMIDA) {
            //Comprobaci√≥n dinero disponible
            if (dinero >= COSTECOMIDA) {
                //Comprueba la comida y a√±ade hasta el maximo
                if (textoAlimento.length < MAXIMOALIMENTO) {
                    while (textoAlimento.length < MAXIMOALIMENTO) {
                        textoAlimento.push("üåæ")
                    }
                    //La comida quitar√° 100 al dinero
                    dinero -= COSTECOMIDA
                    mostrarAlert(MENSAJECOMIDAREPUESTA)
                    actualizarDatos()
                } else {//Ten√≠a el maximo
                    mostrarAlert(MENSAJECOMIDALLENA)
                }
            } else {//No hay dinero para comprar comida
                mostrarAlert(MENSAJENODINERO)
            }

        }//Opci√≥n "Curar Animales"
        else if (opcion == CURARANIMALES) {
            //Comprobaci√≥n del establo
            if (textoEstablo.length > ESTABLOLIMPIO && !articuloCurar) {
                mostrarAlert(MENSAJENECESITASLIMPIAR)
            } else {//Comprueba si esta el animal enfermo y si lo esta lo cura
                if (estadoEnfermo == true) {
                    estadoEnfermo = false
                    estadoAnimal = "üòä"
                    mostrarAlert(MENSAJEANIMALESCURADOS)
                    actualizarDatos()
                } else {//Los animales no estaban enfermos
                    mostrarAlert(MENSAJEANIMALESSALUDABLES)
                }
            }
            if (articuloCurar) {
                articuloCurar = false
                estadoEnfermo = false
                estadoAnimal = "üòä"
                mostrarAlert(MENSAJEANIMALESCURADOS)
                actualizarDatos()
                mostrarAlert("Has usado el objeto medicina")
            }

        }//Opci√≥n "Consultar informacion"
        else if (opcion == INFORMACION) {
            mostrarAlert(MENSAJEINFORMACION)
        }//Opci√≥n "Mercado"
        else if (opcion == MERCADO) {
            compraValida = false
            while (!compraValida) {
                articuloComprado = false
                if (textoFelicidad.length >= 4) {
                    
                }
                let mensajeProductosDisponibles = ("1. " + productosNombreActual[0] + " - " + productoPrecioActual[0] + "G"
                    + "\n2. " + productosNombreActual[1] + " - " + productoPrecioActual[1] + "G"
                    + "\n3. " + productosNombreActual[2] + " - " + productoPrecioActual[2] + "G"
                    + "\n4. " + productosNombreActual[3] + " - " + productoPrecioActual[3] + "G"
                    + "\n5. SALIR"
                    + "\nDime el n¬∫ del producto que quieras comprar")
                usuarioCompra = Number(prompt(mensajeProductosDisponibles))
                //Condicional para saber si usuario introduce n√∫mero valido
                if (usuarioCompra >= PRODUCTO1 && usuarioCompra <= PRODUCTO4) {
                    let productoElegido = usuarioCompra
                    let indice = usuarioCompra - 1
                    let productoNombre = productosNombreActual[indice]
                    let productoPrecio = productoPrecioActual[indice]
                    //Otra condicional para comprobar valor del usuario
                    if (usuarioCompra > 0) {
                        //Bucle para buscar dentro de tu inventario
                        for (let i = 0; i < productosComprados.length; i++) {
                            //Si lo ha comprado no podr√° comprarlo de nuevo
                            if (productoNombre === productosComprados[i]) {
                                mostrarAlert(MENSAJEPRODUCTOESTABACOMPRADO)
                                articuloComprado = true
                            }
                        }//Comprobaci√≥n para saber si puede comprar objeto
                        if (dinero >= productoPrecio && !articuloComprado) {
                            dinero -= productoPrecio
                            productosComprados.push(productoNombre)
                            let mensajeProductoComprado = ("Felicidades, Has comprado " + productoNombre + " por " + productoPrecio + "G")
                            compraValida = true
                            actualizarDatos()
                            mostrarAlert(mensajeProductoComprado)
                        }//No tiene dinero para comprar el objeto
                        else if (dinero < productoPrecio && !articuloComprado) {
                            mostrarAlert(MENSAJENODINERO)
                            compraValida = true
                        }//Si no puede comprar el objeto, llegara a este if, para poder salir
                        if (articuloComprado || dinero < productoPrecio) {
                            compraValida = true
                        }
                    }
                    //Sale del programa
                } else if (usuarioCompra === SALIRMERCADO) {
                    compraValida = true
                } else {//No ha introducido respuesta valida
                    mostrarAlert(MENSAJEERROR)
                }
            }
        } else {
            mostrarAlert("Opci√≥n no v√°lida")
        }
        //Cuando cuente 3 acciones, se suma 1 estiercol y -1 felicidad
        //A su vez, restablece el n¬∫ de acciones
        if (acciones == REINICIOITERACIONES) {
            mostrarAlert(MENSAJEITERACIONES)
            textoFelicidad.pop()
            acciones = 0
            //Mientras que no haya 6 extiercoles, se seguir√° sumando
            if (textoEstablo.length < MAXIMOESTABLO) {
                textoEstablo.push('üí©')
            }
        }
        for (let i = 0; i < productosComprados.length; i++) {
            if ("Medicina" === productosComprados[i]) {
                articuloCurar = true
            }
        }

    }
    mostrarAlert(MENSAJEFINAL)
</script>