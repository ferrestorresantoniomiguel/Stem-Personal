<script>
    //Funciones del programa
    function aleatorio1y10() {
        return Number(Math.floor(Math.random() * 10) + 1)
    }

    function aleatorio1y5() {
        return Number(Math.floor(Math.random() * 5) + 1)
    }

    //---------------------------MAIN-------------------------------------
    //Declarar los principales estados de los animales
    let numeroAnimales = 10
    const felicidadAnimal = 4
    const alimentoAnimal = 3
    const establoAnimal = 1
    let opcion
    let acciones = 0
    let dinero = 1000

    //Variables para "Mercado"
    let contadorIteraciones = 0
    let productosNombre = [
        "Bebedero de Aguaüö∞ - 200G",
        "Refugio para animalesüõñ - 500G",
        "Juguetes para animalesüß∏ - 150G",
        "Malla de SombraüèñÔ∏è - 300G",
        "Sistema de Riegoüíß - 400G",
        "Herramientas de Limpiezaüßπ - 100G",
        "Luz Solar Artificialüí° - 350G",
        "Cercado Mejoradoüîê - 600G"
    ]
    let productosPrecio = [200, 500, 150, 300, 400, 100, 350, 600]
    let productosNombreActual = []
    let productoPrecioActual = []
    let productosComprados = []
    let productosSeleccionados = 0
    let productosTotal = productosNombre.length


    //Variables para la salud de los animales y nombre del "establo"
    let estadoEnfermo = false
    let estadoAnimal = "üòä"
    let establoNombre = prompt("Dime que nombre quieres para tu establo")
    //Variable, para saber que alimento va a dar
    let darAlimento

    //Convertir Felicidad a emoji
    let textoFelicidad = []
    for (let i = 0; i < felicidadAnimal; i++) {
        textoFelicidad.push("‚ù§Ô∏è")
    }
    //Convertir alimento a emoji
    let textoAlimento = []
    for (let i = 0; i < alimentoAnimal; i++) {
        textoAlimento.push("üåæ")
    }
    //Convertir establo a emoji
    let textoEstablo = []
    for (let i = 0; i < establoAnimal; i++) {
        textoEstablo.push("üí©")
    }
    //Bucle principal: Se detiene cuando los animales son 0 y superior de 99
    while (numeroAnimales > 0 && numeroAnimales < 99) {
        //Check para que cambien los objetos cada 5 veces y al inicio del programa
        if (contadorIteraciones % 5 === 0 || productosNombreActual.length === 0) {
            productosNombreActual = []
            productoPrecioActual = []
            productosSeleccionados = 0
            productosTotal = productosNombre.length
            //Bucle para seleccionar 4 productos
            while (productosSeleccionados < 4) {
                let indiceRandom = Math.floor(Math.random() * productosTotal)
                let productoActual = productosNombre[indiceRandom]
                let precioActual = productosPrecio[indiceRandom]
                let productoComprado = false
                let productoseleccionado = false
                //Comprobaci√≥n para saber si el producto ha sido comprado
                for (let i = 0; i < productosComprados.length; i++) {
                    if (productosComprados[i] === productoActual) {
                        productoComprado = true
                    }
                }
                //Comprobaci√≥n para saber si el producto se repite
                for (let x = 0; x < productosNombreActual.length; x++) {
                    if (productosNombreActual[x] === productoActual) {
                        productoseleccionado = true
                    }
                }
                //Si el producto no se ha comprado ni se ha repetido, lo pushearemos en los productos actuales
                if (!productoComprado && !productoseleccionado) {
                    productosNombreActual.push(productoActual)
                    productoPrecioActual.push(precioActual)
                    productosSeleccionados++
                }
            }
        }


        if (textoEstablo.length >= 4) {
            estadoEnfermo = true
            estadoAnimal = "ü§í"
            alert("Tus animales han enfermado ü§í")
        }
        //Muestra la pantalla inicial
        alert("Felicidad: " + textoFelicidad.join(" ") + "\nAlimentos Disponibles: " + textoAlimento.join(" ") + "\nEstablo: " + textoEstablo.join(" ")
            + "\nEstado de Salud: " + estadoAnimal + "\nN¬∫ Animales: " + numeroAnimales + "\nDinero: " + dinero + "G" + "\nInventario : " + productosComprados.join(" "))

        opcion = prompt("Felicidad: " + textoFelicidad.join(" ") + "\nAlimentos Disponibles: " + textoAlimento.join(" ") + "\nEstablo: " + textoEstablo.join(" ")
            + "\nEstado de Salud: " + estadoAnimal + "\nN¬∫ Animales: " + numeroAnimales + "\nDinero: " + dinero + "G" + "\nElige una acci√≥n: " + "\n1. ü•ï ALIMENTAR A LOS ANIMALES ü•ï " + "\n2. üêëJUGAR CON LOS ANIMALES üêë "
            + "\n3. üí©LIMPIAR EL ESTABLO üí© " + "\n4. üõí COMPRAR COMIDA üõí " + "\n5. ü©∫CURAR ANIMALES ü©∫ " + "\n6. ‚ÑπÔ∏èCONSULTAR INFORMACI√ìN ‚ÑπÔ∏è " + "\n7. üööMERCADOüöö")

        //Entra en la opci√≥n "Alimentar animales"
        if (opcion == "1") {
            //Comprobaci√≥n del "establo"
            if (textoEstablo.length <= 3) {
                darAlimento = prompt("Dime que opcion de alimento quieres dar: " + "\n1. Dar Forraje üåæ " + "\n2. Dar Fruta üçé")
                if (darAlimento == "1") {
                    if (textoAlimento.length >= 1) {
                        textoAlimento.pop()
                        acciones += 1
                        contadorIteraciones += 1
                        //Suma a los animales n¬∫random entre 1-10
                        //Resta a los animales n¬™random entre 1-5
                        numeroAnimales += aleatorio1y10()
                        numeroAnimales -= aleatorio1y5()
                        alert("Le has dado de comer Forraje üåæ")
                    } else {
                        alert("No tienes comida disponibleüåæüåæ")
                    }
                } else if (darAlimento == "2") {
                    //Comprueba que haya comida disponible
                    if (textoAlimento.length >= 1 && estadoEnfermo == false) {
                        textoAlimento.pop()
                        acciones += 1
                        contadorIteraciones += 1
                        numeroAnimales += aleatorio1y10()
                        numeroAnimales -= aleatorio1y5()

                        //Comprueba que no supere el limite de "felicidad"
                        if (textoFelicidad.length < 4) {
                            textoFelicidad.push("‚ù§Ô∏è")
                        }

                        alert("Le has dado de comer Fruta üçé")

                        //Si no hay comida, manda alert
                    } else {
                        alert("No tienes comida disponible o los animales enfermos no pueden comer frutaüçé")
                    }
                }
                //alert, por si hay demasiado extiercol, caso "alimentar"
            } else {
                alert("üí©No puedes alimentar a los animales, el entorno est√° demasiado sucioüí©")
            }
        } //Entra en la opci√≥n "Jugar con los animales"
        else if (opcion == "2") {
            //Comprobaci√≥n del "establo"
            if (textoEstablo.length <= 3 && estadoEnfermo == false) {
                //Comprueba que haya comida disponible
                if (textoAlimento.length >= 1) {
                    textoAlimento.pop()
                    acciones += 1
                    contadorIteraciones += 1
                    numeroAnimales += aleatorio1y10()
                    numeroAnimales -= aleatorio1y5()
                    //N¬∫ random entre 100 y 200 para sumarselo a nuestro dinero
                    let dineroSumar = Math.floor(Math.random() * 101) + 100
                    dinero += dineroSumar

                    //Comprueba que no supere el limite de "felicidad"
                    if (textoFelicidad.length < 4) {
                        textoFelicidad.push('‚ù§Ô∏è')
                        textoFelicidad.join()
                    }
                    alert("Has ganado " + dineroSumar + "G")
                    alert("Hemos jugado con los animalesüêÑ")
                    //Si no hay comida, manda alert
                } else {
                    alert("No tienes comida disponibleüçéüåæ")
                }
                //alert, por si hay demasiado extiercol, opci√≥n "jugar"
            } else {
                alert("No puedes jugar con los animales, ya que el ambiente es inadecuado o est√°n enfermosüí©ü§í")
            }
        } //Entra en la opci√≥n "Limpiar establo"
        else if (opcion == "3") {
            if (textoEstablo.length > 0) {
                while (textoEstablo.length > 0) {
                    textoEstablo.pop()
                }
                alert("Establo limpiadoüßπüí©")
                acciones += 1
                contadorIteraciones += 1
                numeroAnimales += aleatorio1y10()
                numeroAnimales -= aleatorio1y5()
            } else {
                alert("üßπTienes el establo limpio, no hace falta limpiarüßπ")
            }
        } //Entra en la opci√≥n "Comprar comida"
        else if (opcion == "4") {
            if (dinero >= 100) {
                //La comida quitar√° 100 al dinero
                let costeComida = 100
                dinero -= costeComida
                if (textoAlimento.length < 4) {
                    while (textoAlimento.length < 4) {
                        textoAlimento.push("üåæ")
                    }
                    alert("Comida repuestaüåæüçé, te ha costado " + costeComida + "G")
                    acciones += 1
                    contadorIteraciones += 1
                    numeroAnimales += aleatorio1y10()
                    numeroAnimales -= aleatorio1y5()
                } else {
                    alert("üåæNo puedes comprar m√°s comida, estas llenoüåæ")
                }
            } else {
                alert("No tienes suficiente dineroüí≤")
            }

        }//Entra en la opci√≥n "Curar Animales"
        else if (opcion == "5") {
            if (textoEstablo.length > 0) {
                alert("Necesitas tener el establo limpio para poder curarlosüßπüßπ")
            } else {
                //Comprueba si esta el animal enfermo y si lo esta lo cura
                if (estadoEnfermo == true) {
                    estadoEnfermo = false
                    estadoAnimal = "üòä"
                    acciones += 1
                    contadorIteraciones += 1
                    alert("Tus animales ya est√°n curados ü©πü©π")
                    numeroAnimales += aleatorio1y10()
                    numeroAnimales -= aleatorio1y5()
                } else {
                    alert("Tus animales ya estaban saludables, no necesitan curaci√≥n üòäüòä")
                }
            }
        }//Entra en la opci√≥n "Consultar informacion"
        else if (opcion == "6") {
            alert("Nombre del Establo: " + establoNombre + "\nN√∫mero de animales: " + numeroAnimales)
        }
        else if (opcion == "7") {
            let compraValida = false
            while (!compraValida) {
                let articuloComprado = false
                let usuarioCompra = prompt("1. " + productosNombreActual[0] + "\n2. " + productosNombreActual[1]
                    + "\n3. " + productosNombreActual[2] + "\n4. " + productosNombreActual[3] + "\n5. SALIR"
                    + "\nDime el n¬∫ del producto que quieras comprar")
                if (usuarioCompra === "1") {
                    if (dinero < 9999 && dinero > 0) {
                        for (let i = 0; i < productosComprados.length; i++) {
                            if (productosNombreActual[0] === productosComprados[i]) {
                                alert("Ya lo has comprado anteriormente")
                                articuloComprado = true
                            }
                        }
                        if (dinero >= productoPrecioActual[0] && !articuloComprado) {
                            dinero -= productoPrecioActual[0]
                            productosComprados.push(productosNombreActual[0])
                            compraValida = true
                            acciones += 1
                            contadorIteraciones += 1
                        } else if (dinero < productoPrecioActual[0] && !articuloComprado) {
                            alert("No tienes dinero suficienteüí≤")
                        }
                    } else {
                        alert("No tienes dineroüí≤")
                    }
                }
                if (usuarioCompra === "2") {
                    if (dinero < 9999 && dinero > 0) {
                        for (let i = 0; i < productosComprados.length; i++) {
                            if (productosNombreActual[1] === productosComprados[i]) {
                                alert("Ya lo has comprado anteriormente")
                                articuloComprado = true
                            }
                        }
                        if (dinero >= productoPrecioActual[1] && !articuloComprado) {
                            dinero -= productoPrecioActual[1]
                            productosComprados.push(productosNombreActual[1])
                            compraValida = true
                            acciones += 1
                            contadorIteraciones += 1
                        } else if (dinero < productoPrecioActual[1] && !articuloComprado) {
                            alert("No tienes dinero suficienteüí≤")
                        }
                    } else {
                        alert("No tienes dineroüí≤")
                    }
                }
                if (usuarioCompra === "3") {
                    if (dinero < 9999 && dinero > 0) {
                        for (let i = 0; i < productosComprados.length; i++) {
                            if (productosNombreActual[2] === productosComprados[i]) {
                                alert("Ya lo has comprado anteriormente")
                                articuloComprado = true
                            }
                        }
                        if (dinero >= productoPrecioActual[2] && !articuloComprado) {
                            dinero -= productoPrecioActual[2]
                            productosComprados.push(productosNombreActual[2])
                            compraValida = true
                            acciones += 1
                            contadorIteraciones += 1
                        } else if (dinero < productoPrecioActual[2] && !articuloComprado) {
                            alert("No tienes dinero suficienteüí≤")
                        }
                    } else {
                        alert("No tienes dineroüí≤")
                    }
                }
                if (usuarioCompra === "4") {
                    if (dinero < 9999 && dinero > 0) {
                        for (let i = 0; i < productosComprados.length; i++) {
                            if (productosNombreActual[3] === productosComprados[i]) {
                                alert("Ya lo has comprado anteriormente")
                                articuloComprado = true
                            }
                        }
                        if (dinero >= productoPrecioActual[3] && !articuloComprado) {
                            dinero -= productoPrecioActual[3]
                            productosComprados.push(productosNombreActual[3])
                            compraValida = true
                            acciones += 1
                            contadorIteraciones += 1
                        } else if (dinero < productoPrecioActual[3] && !articuloComprado) {
                            alert("No tienes dinero suficienteüí≤")
                        }
                    } else {
                        alert("No tienes dineroüí≤")
                    }
                }
                if (usuarioCompra === "5") {
                    compraValida = true
                }
            }
        }
        //Cuando cuente 3 acciones, se suma 1 estiercol y -1 felicidad
        //A su vez, restablece el n¬∫ de acciones
        if (acciones == 3) {
            alert("Se suma (+üí©) y se resta (-‚ù§Ô∏è) x cada 3 Acciones")
            textoFelicidad.pop()
            acciones = 0
            //Mientras que no haya 6 extiercoles, se seguir√° sumando
            if (textoEstablo.length < 6) {
                textoEstablo.push('üí©')
            }
        }
    }
</script>